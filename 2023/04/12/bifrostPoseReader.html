<!DOCTYPE html>

<html>
    <head>
    
        <meta charset="UTF-8">

<title> Ivan Cuenca Rigging </title>

<link rel="icon" type="image/svg+xml" href="/assets/images/logo.svg">

<meta name="description" content="3D rigger focused on characters and tools">

<meta name="keywords" content="rigging, Python programming, 3D animation, portfolio, artist, modeling">

<link rel="stylesheet" type="text/css" href="/assets/css/reset.css">
<link rel="stylesheet" type="text/css" href="/assets/css/default.css">
        
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

<script defer src="/assets/js/header.js"></script>
<script defer src="/assets/js/toggle_color_theme.js"></script>
<script defer src="/assets/js/current_page.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    </head>

    <body>

        <header>
        
            <div class="container">
    <!-- LOGO -->
    <a href="/">
        <svg class="logo" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 743.72 743.11">
            <path d="M553.16,683.2c-152.78,89.71-363.1,55.55-476.25-106.35C23.5,497.89,3.29,411.1,17.42,316.92 C32.62,215.7,88.2,139.19,146.4,92.72c0.1,0.61,0.22,1.1,0.25,1.59c0.04,0.72,0.01,1.44,0.01,2.16 c0,91.44-0.02,182.87,0.04,274.31c0.01,7.41,0.62,14.82,0.96,22.23c0.03,0.55,0.16,1.09,0.29,1.92c134.52,0,269.02,0,403.92,0 c-3.06,23.45-10.2,45.16-21.58,65.5c-11.45,20.47-26.33,38.04-44.62,52.71c-18.23,14.62-38.55,25.35-60.93,32.01 c-87.73,26.09-182.63-16.51-219.23-104.42c-15.92,0-31.89,0-47.89,0c17.48,58.66,67.47,121.41,146.19,146.66 c29.79,9.56,60.3,12.8,91.45,9.69c31.24-3.12,60.58-12.38,87.97-27.73c27.32-15.31,50.44-35.51,69.44-60.37 c0.2,0.11,0.28,0.14,0.34,0.19c0.06,0.04,0.14,0.11,0.14,0.16C553.16,567.24,553.16,625.15,553.16,683.2z"/>
            <path d="M192.26,235.81c0-1.37,0-2.13,0-2.9c0-56.48,0.01-112.96-0.04-169.43c0-1.84,0.54-2.82,2.16-3.74 c19.52-11.03,39.84-20.27,61.04-27.59c18.83-6.5,38.06-11.39,57.69-14.7c9.66-1.63,19.38-2.98,29.18-3.58 c5.25-0.32,10.5-0.78,15.75-0.92c8.63-0.23,17.26-0.51,25.88-0.28c8.19,0.22,16.38,1.01,24.55,1.69c12.09,1,24.05,2.96,35.93,5.36 c12.53,2.53,24.87,5.76,37.06,9.61c14.49,4.57,28.62,10.05,42.4,16.44c15.1,7,29.64,15.01,43.64,24.02 c13.59,8.75,26.53,18.37,38.81,28.87c4.73,4.04,9.27,8.32,13.83,12.55c3.04,2.83,6.03,5.72,8.94,8.69 c10.26,10.43,19.85,21.44,28.77,33.04c10.54,13.71,20.04,28.1,28.49,43.17c10.45,18.64,19.2,38.06,26.19,58.27 c4.57,13.22,8.39,26.65,11.39,40.3c2.38,10.83,4.37,21.74,5.59,32.76c0.75,6.81,1.46,13.63,1.9,20.46 c0.39,6.05,0.51,12.13,0.53,18.19c0.04,9.12,0.09,18.24-0.24,27.35c-0.24,6.44-0.97,12.87-1.72,19.27 c-0.81,6.88-1.74,13.76-2.89,20.59c-2.78,16.47-6.79,32.64-11.88,48.55c-4.53,14.17-9.89,28.01-16.13,41.49 c-6.99,15.1-15,29.65-24.03,43.64c-7.94,12.3-16.51,24.13-25.97,35.3c-4.95,5.85-10.05,11.57-15.3,17.15 c-4.87,5.18-9.94,10.18-15.08,15.1c-6.22,5.95-12.71,11.59-19.76,17.2c-0.05-1.15-0.12-1.98-0.12-2.81c-0.01-24,0-48,0-72 c0-67.92,0.03-135.84-0.04-203.75c-0.01-7.09-0.59-14.18-0.94-21.27c-0.04-0.78-0.29-1.54-0.49-2.53c-134.48,0-268.92,0-403.72,0 c1.1-10.35,3.33-20.18,6.29-29.85c7.97-26.08,21.12-49.23,39.54-69.35c20.07-21.92,44.08-38.11,72.11-47.94 c45.37-15.92,90.4-14.54,134.4,4.92c44.09,19.5,75.01,52.28,94.07,96.53c15.86,0,31.75,0,48,0 c-6.99-22.01-16.99-42.33-30.17-61.04c-25.21-35.77-57.95-62.34-98.4-79.07c-47.37-19.6-96.04-22.95-145.56-9.63 C264.35,167.28,224.12,194.87,192.26,235.81z"/>
        </svg>

    </a>

    <!-- BURGER -->
    <button class="button">
        <svg class="svg" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5zm0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5z"/>
        </svg>
    </button>

    <!-- NAV -->
    <nav class="nav">

        <ul class="ul">
        
            <li class="li"><a class="a" href="/blog"> Blog </a></li>
        
            <li class="li"><a class="a" href="/projects"> Projects </a></li>
        
            <li class="li"><a class="a" href="/resources"> Resources </a></li>
        
        </ul>

        <!-- COLOR THEME BUTTON -->
        <div class="color-theme-container">
            <div class="color-theme-button"></div>
        </div>

    </nav>
</div>
        
        </header>

        <main>
        
            <h1 class="title">Bifrost pose reader</h1>

<p><img src="\assets\images\posts\bifrostPoseReader\thumbnail.gif" alt="barycentric gif" /></p>

<p><br /></p>

<h1 id="barycentric-theorem">Barycentric theorem</h1>
<p>The Barycentric Theorem is a mathematical formula that relates the segments in a triangle with its barycenter, the point of intersection of the medians of the triangle.
<br /></p>

<p><em>IMAGEN ABCP</em></p>

<p><br /></p>

<h1 id="inputs">INPUTS</h1>
<ul>
  <li>Geometry <strong>triangulated</strong>.</li>
  <li>Driver: Node transform / locator.</li>
</ul>

<p><br /></p>

<h1 id="pasos">PASOS</h1>
<ol>
  <li>
    <p>Find the projected point (<strong>P</strong>) on the geometry using the direction vector of the driver.</p>

    <p><img src="/assets/images/posts/bifrostPoseReader/raycast_graph.png" alt="raycast bifrost graph" /></p>

    <p>The first thing is to find the direction in which we must project the point onto the geometry. We will use the <strong>rotate_by_quaternion</strong> node and pass the quaternion of our driver and the vector onto which we want to project (1, 0, 0) as input.</p>

    <p>Once we have our vector, we will use the <strong>get_raycast_locations</strong> node to project the direction onto the geometry. It is important to disable the use cutoff distance option.</p>

    <p>We must take into account that this node requires arrays as inputs, so we will use the build_array node to pass the data to it.</p>

    <p>Once we have our projected point <strong>P</strong>, we need to be able to access its position. For this, we can use the sample_property node, passing the geometry and the locations as inputs.</p>

    <p><br /></p>
  </li>
  <li>
    <p>Determine the face on which point <strong>P</strong> is located</p>

    <p><img src="/assets/images/posts/bifrostPoseReader/closest_face_graph.png" alt="closest face graph" /></p>

    <p>To determine the closest face, we will use the <strong>get_closest_locations</strong> node, which provides information such as the closest position of a point on the geometry. Specifically, we are seeking the closest face. To extract this information, we will create a value node and set it as the value of <strong>GeoLocation</strong>.</p>

    <p><img class="img-small" src="/assets/images/posts/bifrostPoseReader/geoLocation_value_node.png" alt="geoLocation value node" /></p>

    <p>The output is an array, so we’ll use the <strong>first_in_array</strong> node to get the first value.</p>

    <p><br /></p>
  </li>
  <li>
    <p>Extract the vertices of the face where we are <strong>ABC</strong>.</p>

    <p>To obtain the 3 vertices that form our face, we need to use the <strong>get_mesh_structure</strong> node. This node provides valuable information as output, such as the number of vertices, number of faces, among others.</p>

    <p><img src="/assets/images/posts/bifrostPoseReader/face_vertex_graph.png" alt="face vertex graph" /></p>

    <p><br /></p>
  </li>
  <li>
    <p>Calculate the area of <strong>ABC</strong>.
 This step may seem very complex, but it is as simple as looking for the formula on the internet and applying it with bifrost nodes, our inputs are 3 points so we must do the following steps:</p>

    <ul>
      <li>Vector <strong>AB</strong> (B - A) and vector <strong>AC</strong> (C - A)</li>
      <li>Cross product: vector that is perpendicular to the plane formed by the two previous vectors.</li>
      <li>(√ X^2 + Y^2 + Z^2) / 2</li>
    </ul>

    <p><img src="/assets/images/posts/bifrostPoseReader/area_graph.png" alt="area graph" /></p>

    <p><br /></p>
  </li>
  <li>
    <p>Calculate the area of <strong>PA</strong>.</p>
  </li>
</ol>

<p>Repeat step <strong>4</strong> but with the points <strong>BCP</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;br&gt;
</code></pre></div></div>

<ol>
  <li>
    <p>Calculate the area of <strong>PB</strong>.</p>

    <p>Repeat step <strong>4</strong> but with the points <strong>ACP</strong></p>

    <p><br /></p>
  </li>
  <li>
    <p>Calculate the area of <strong>PC</strong>.</p>

    <p>Repeat step <strong>4</strong> but with the points <strong>ABP</strong></p>

    <p><br /></p>
  </li>
  <li>
    <p>build the output.</p>

    <p>As output we are going to need an array with a value for each vertex, if that vertex is part of the face in which we find ourselves it will have a value, otherwise that vertex will be set to 0. At most we can have 3 vertices with values and always the sum should give 1.</p>

    <p><img src="/assets/images/posts/bifrostPoseReader/build_output.png" alt="build_output" /></p>

    <p>For this graph we are going to need the number of vertices of our geometry <em>max_iterations</em>, we will create an empty array with the node <strong>for_each</strong> with the same length as <em>max_iterations</em>.</p>

    <p>Now we need to modify this array, we are going to use the weights that we have obtained (<em>output1</em>, <em>output2</em> and <em>output3</em>) from all the operations and through the <strong>set_in_array</strong> node we are going to set the vertices that must have these information (* value<em>, *value1</em> and <em>value2</em>).</p>

    <hr />

    <p>Finally we already have as output the weights that each of our vertices will have and since they are values between 0 and 1 we can use them to trigger our blendshapes.</p>

    <p><br /></p>
  </li>
</ol>



  <a class="download-button" href="https://ivancuencarigging.gumroad.com/l/PoseReader" target="_blank">Download</a>


<p class="date">Iván Cuenca Ruiz - 12 / 04 / 2023</p>

        
        </main>

        <footer>
        
            <div class="container">
    
    <div class="social">
        
            
                <a href="https://www.linkedin.com/in/ivan-cuenca-ruiz/" target="_blank"> <i class="fab fa-linkedin-in icon"></i></a>
            
                <a href="https://github.com/ivan-cuenca-rigging/" target="_blank"> <i class="fab fa-github icon"></i></a>
            
                <a href="https://www.instagram.com/ivan_cuenca_rigging/" target="_blank"> <i class="fab fa-instagram icon"></i></a>
            
                <a href="mailto:ivan.cuenca.rigging@gmail.com" target="_blank"> <i class="far fa-envelope icon"></i></a>
            

    </div>

    <p>2023 &copy; Iván Cuenca Ruiz</p>

</div>
        
        </footer>

    </body>
</html>
